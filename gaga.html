<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAGA GAME</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(120deg, #e0e7ff 0%, #c6f0e7 40%, #f4f4f9 100%);
            text-align: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        h1 {
            color: #2d3a4b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-size: 2.2rem;
            font-weight: 700;
        }

        .button-container {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .button-row {
            display: flex;
            justify-content: center;
            gap: 32px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        button {
            background: linear-gradient(90deg, #4f8cff 0%, #38d39f 100%);
            color: #fff;
            border: none;
            padding: 16px 36px;
            font-size: 17px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(.4,0,.2,1);
            min-width: 130px;
            box-shadow: 0 2px 8px rgba(79,140,255,0.08);
            font-weight: 600;
            outline: none;
        }

        button:hover {
            background: linear-gradient(90deg, #38d39f 0%, #4f8cff 100%);
            transform: translateY(-3px) scale(1.04);
            box-shadow: 0 6px 18px rgba(56,211,159,0.13);
        }

        button:active {
            background: linear-gradient(90deg, #4f8cff 0%, #38d39f 100%);
            transform: scale(0.98);
        }

        /* ÈÖçÁΩÆÊåâÈíÆÊ†∑Âºè */
        .config-button {
            background: linear-gradient(90deg, #007bff 0%, #38d39f 100%);
            color: #fff;
            border: none;
            padding: 18px 44px;
            font-size: 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(.4,0,.2,1);
            min-width: 160px;
            box-shadow: 0 4px 16px rgba(56,211,159,0.10);
            font-weight: 700;
            outline: none;
            margin: 0 8px;
            letter-spacing: 1px;
        }
        .config-button:hover {
            background: linear-gradient(90deg, #38d39f 0%, #007bff 100%);
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 8px 24px rgba(56,211,159,0.18);
        }
        .config-button:active {
            background: #0056b3;
            transform: scale(0.98);
        }

        /* ÂàÜÁªÑÊåâÈíÆÊ†∑Âºè */
        .group-button {
            background: linear-gradient(90deg, #28a745 0%, #38d39f 100%);
        }
        .group-button:hover {
            background: linear-gradient(90deg, #38d39f 0%, #28a745 100%);
        }
        .group-button:active {
            background: #1e7e34;
        }

        /* ÂºπÁ™óÊ†∑Âºè‰ºòÂåñ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(44,62,80,0.55);
            backdrop-filter: blur(3px);
        }
        .modal-content {
            background: #fff;
            margin: 3% auto;
            padding: 0;
            border: none;
            border-radius: 18px;
            width: 95%;
            max-width: 900px;
            max-height: 92vh;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(44,62,80,0.18);
            animation: modalSlideIn 0.35s cubic-bezier(.4,0,.2,1);
        }
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-60px) scale(0.92);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        .modal-header {
            padding: 22px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }
        .modal-header h2 {
            margin: 0;
            color: #2d3a4b;
            font-size: 20px;
        }
        .close {
            color: #666;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .close:hover,
        .close:focus {
            color: #fff;
            background: #007bff;
        }
        .modal-body {
            padding: 24px 30px;
            max-height: calc(92vh - 120px);
            overflow-y: auto;
        }
        /* Ë°®ÂçïÊ†∑Âºè */
        .form-container {
            text-align: left;
        }
        .form-section {
            margin-bottom: 28px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            background: #f8f9fa;
            box-shadow: 0 1px 4px rgba(44,62,80,0.04);
        }
        .form-section-header {
            background: linear-gradient(90deg, #007bff 0%, #38d39f 100%);
            color: #fff;
            padding: 12px 18px;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-section-content {
            padding: 18px;
            background: #fff;
            border-radius: 0 0 10px 10px;
        }
        .form-group {
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .form-group label {
            min-width: 110px;
            font-weight: 600;
            color: #2d3a4b;
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            flex: 1;
            padding: 9px 14px;
            border: 1px solid #bfc9d1;
            border-radius: 5px;
            font-size: 15px;
            transition: border-color 0.2s;
            background: #f4f8fb;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #38d39f;
            box-shadow: 0 0 0 2px rgba(56,211,159,0.13);
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .add-item-btn {
            background: linear-gradient(90deg, #38d39f 0%, #4f8cff 100%);
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .add-item-btn:hover {
            background: linear-gradient(90deg, #4f8cff 0%, #38d39f 100%);
        }
        .remove-item-btn {
            background: #e0e0e0;
            color: #888;
            border: none;
            width: 28px;
            height: 28px;
            min-width: 28px;
            min-height: 28px;
            max-width: 28px;
            max-height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 6px;
            transition: background 0.18s, color 0.18s;
            box-shadow: none;
            padding: 0;
        }
        .remove-item-btn:hover {
            background: #bdbdbd;
            color: #555;
        }
        .remove-item-btn:active {
            background: #b0b0b0;
            color: #333;
        }
        /* ÂàóË°®ÂÆπÂô®Ê†∑Âºè */
        .list-container {
            margin-top: 8px;
        }
        .list-items {
            margin-bottom: 8px;
        }
        .list-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 7px;
            padding: 7px;
            background: #f4f8fb;
            border: 1px solid #e3e8ee;
            border-radius: 5px;
        }
        .list-item input[type="text"] {
            flex: 1;
            padding: 7px 10px;
            border: 1px solid #bfc9d1;
            border-radius: 4px;
            font-size: 14px;
            background: #fff;
        }
        .list-item input[type="text"]:focus {
            outline: none;
            border-color: #38d39f;
            box-shadow: 0 0 0 2px rgba(56,211,159,0.13);
        }
        .list-item .remove-item-btn {
            padding: 4px 8px;
            font-size: 12px;
            margin-left: 0;
        }
        .hero-item {
            border: 1px solid #e3e8ee;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: #f8f9fa;
            position: relative;
            box-shadow: 0 1px 4px rgba(44,62,80,0.04);
        }
        .hero-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .hero-item-title {
            font-weight: bold;
            color: #007bff;
        }
        .yaml-content {
            background: #f4f8fb;
            border: 1px solid #e3e8ee;
            border-radius: 8px;
            padding: 16px;
            text-align: left;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .yaml-editor {
            background: #fff;
            border: 2px solid #e3e8ee;
            border-radius: 8px;
            padding: 16px;
            text-align: left;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            width: 100%;
            min-height: 300px;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        .yaml-editor:focus {
            outline: none;
            border-color: #38d39f;
            box-shadow: 0 0 0 2px rgba(56,211,159,0.13);
        }
        /* ÈÄâÈ°πÂç°Ê†∑Âºè */
        .tab-container {
            margin-bottom: 20px;
        }
        .tab-header {
            display: flex;
            border-bottom: 2.5px solid #e3e8ee;
            margin-bottom: 18px;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            background: #f4f8fb;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 1px 4px rgba(44,62,80,0.04);
        }
        .tab-button {
            padding: 12px 22px;
            background: #f4f8fb;
            border: none;
            border-radius: 10px 10px 0 0;
            margin-right: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            top: 1px;
            font-weight: 600;
            color: #38d39f;
        }
        .tab-button.active {
            background: linear-gradient(90deg, #38d39f 0%, #4f8cff 100%);
            color: #fff;
            box-shadow: 0 2px 8px rgba(56,211,159,0.10);
            border-bottom: 2.5px solid #38d39f;
        }
        .tab-content {
            display: none;
            background: #f8f9fa;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 1px 4px rgba(44,62,80,0.04);
            padding: 18px 8px 8px 8px;
            margin-bottom: 10px;
        }
        .tab-content.active {
            display: block;
        }
        .hero-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 18px;
            margin-top: 10px;
            background: #f4f8fb;
            border-radius: 10px;
            padding: 12px 8px;
        }
        .hero-item-simple {
            padding: 16px 8px;
            background: #fff;
            border-radius: 10px;
            border: 1.5px solid #e3e8ee;
            text-align: center;
            transition: all 0.2s;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(44,62,80,0.06);
        }
        .hero-item-simple:hover {
            background: #e0e7ff;
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 6px 18px rgba(56,211,159,0.13);
        }
        /* ÂìçÂ∫îÂºèÂíåÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 900px) {
            .modal-content {
                width: 99%;
                margin: 2% auto;
                max-height: 95vh;
            }
            .modal-header, .modal-body {
                padding-left: 10px;
                padding-right: 10px;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px 2px;
            }
            h1 {
                font-size: 22px;
                margin-bottom: 18px;
            }
            .button-row {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }
            button {
                width: 98vw;
                max-width: 320px;
                padding: 18px 10px;
                font-size: 16px;
                touch-action: manipulation;
            }
            .modal-content {
                width: 99vw;
                margin: 1vw auto;
                max-height: 90vh;
            }
            .modal-header {
                padding: 12px 8px;
            }
            .modal-header h2 {
                font-size: 15px;
            }
            .modal-body {
                padding: 10px 8px;
                max-height: calc(90vh - 120px);
            }
            .form-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            .form-group label {
                min-width: auto;
                margin-bottom: 3px;
            }
            .yaml-content, .yaml-editor {
                font-size: 12px;
                padding: 10px;
                max-height: 220px;
            }
            .modal-buttons {
                flex-direction: column-reverse;
                gap: 8px;
            }
            .modal-buttons button {
                width: 100%;
                padding: 12px 10px;
                font-size: 15px;
            }
            .edit-mode-toggle {
                flex-direction: column;
                gap: 10px;
            }
            .mode-switch {
                width: 100%;
                justify-content: center;
            }
            .toggle-edit-btn, .toggle-view-btn {
                width: 90px;
                padding: 10px 0;
                font-size: 13px;
            }
            .close {
                font-size: 20px;
                width: 30px;
                height: 30px;
            }
            .hero-grid {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            }
        }
        @media (max-width: 480px) {
            .modal-content {
                width: 100vw;
                margin: 0 auto;
                border-radius: 8px;
            }
            .modal-header {
                padding: 8px 4px;
            }
            .modal-body {
                padding: 8px 4px;
            }
            .yaml-content, .yaml-editor {
                font-size: 11px;
                padding: 6px;
            }
        }
        /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            button:hover {
                transform: none;
                box-shadow: 0 2px 4px rgba(79,140,255,0.08);
            }
            button:active {
                transform: scale(0.98);
            }
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            margin-bottom: 36px;
        }
        .logo-circle {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #38d39f 0%, #4f8cff 100%);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(56,211,159,0.13);
            letter-spacing: 1px;
        }
        /* Âç°ÁâáÂºèÂàóË°® */
        .hero-card, .user-card {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(44,62,80,0.08);
            padding: 18px 16px;
            margin-bottom: 18px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: box-shadow 0.2s;
        }
        .hero-card:hover, .user-card:hover {
            box-shadow: 0 6px 24px rgba(56,211,159,0.13);
        }
        /* TabÂàáÊç¢Âä®Áîª */
        .tab-header {
            border-bottom: 2px solid #e3e8ee;
        }
        .tab-button {
            transition: background 0.2s, color 0.2s, border 0.2s;
        }
        .tab-button.active {
            background: #38d39f;
            color: #fff;
            border-bottom: 2px solid #38d39f;
        }
        /* ÊåâÈíÆÊ≥¢Á∫πÂä®Áîª */
        button {
            position: relative;
            overflow: hidden;
        }
        button:active::after {
            content: '';
            position: absolute;
            left: 50%; top: 50%;
            width: 120%; height: 120%;
            background: rgba(56,211,159,0.15);
            border-radius: 50%;
            transform: translate(-50%,-50%) scale(0.8);
            animation: ripple 0.4s;
        }
        @keyframes ripple {
            to { opacity: 0; transform: translate(-50%,-50%) scale(1.5);}
        }
        /* ToastÊèêÁ§∫ */
        .toast {
            position: fixed;
            left: 50%;
            bottom: 40px;
            transform: translateX(-50%);
            background: #38d39f;
            color: #fff;
            padding: 12px 28px;
            border-radius: 24px;
            font-size: 16px;
            box-shadow: 0 2px 12px rgba(44,62,80,0.13);
            opacity: 0;
            pointer-events: none;
            z-index: 2000;
            transition: opacity 0.3s;
        }
        .toast.show {
            opacity: 1;
            pointer-events: auto;
        }
        @media (max-width: 600px) {
            .header { gap: 10px; margin-bottom: 18px; }
            .logo-circle { width: 32px; height: 32px; font-size: 1.3rem; }
            .hero-card, .user-card { padding: 12px 6px; }
            .tab-header { font-size: 15px; }
            button { font-size: 16px; }
        }
        .group-result-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 18px 0 0 0;
            max-width: 420px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        .group-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 8px rgba(44,62,80,0.08);
            padding: 12px 8px 10px 8px;
            transition: box-shadow 0.2s, transform 0.2s;
            margin-bottom: 0;
            max-width: 400px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        .group-card:hover {
            box-shadow: 0 8px 32px rgba(56,211,159,0.18);
            transform: translateY(-2px) scale(1.02);
        }
        .group-title {
            font-size: 15px;
            font-weight: 700;
            color: #38d39f;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .group-index {
            width: 20px; height: 20px; font-size: 11px;
        }
        .group-members {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .member-chip {
            background: #f4f8fb;
            border-radius: 8px;
            padding: 7px 16px;
            font-size: 15px;
            color: #2d3a4b;
            font-weight: 500;
            box-shadow: 0 1px 4px rgba(44,62,80,0.04);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .member-pos {
            color: #007bff;
            font-weight: 600;
            margin-right: 4px;
        }
        .member-name {
            color: #38d39f;
            font-weight: 700;
            margin-right: 4px;
        }
        .member-hero {
            color: #ff9800;
            font-weight: 600;
        }
        @media (max-width: 600px) {
            .group-result-container {
                grid-template-columns: 1fr;
                gap: 14px;
                margin: 18px 0;
            }
            .group-card { padding: 14px 6px 10px 10px; }
            .group-title { font-size: 15px; }
            .group-index { width: 22px; height: 22px; font-size: 12px; }
            .member-chip { font-size: 13px; padding: 6px 8px; }
        }
        .group-remark {
            margin: 18px 0 0 0;
            padding: 10px 16px;
            color: #888;
            font-size: 13px;
            background: none;
            border-radius: 0;
            box-shadow: none;
            text-align: left;
        }
        .remark-line {
            margin-bottom: 4px;
            color: #aaa;
            font-size: 13px;
            font-style: italic;
            letter-spacing: 0.5px;
        }
        .group-members.fixed-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: flex-start;
        }
        .member-chip.fixed-chip {
            min-width: 140px;
            max-width: 160px;
            flex: 0 0 140px;
            box-sizing: border-box;
            text-align: left;
            justify-content: flex-start;
        }
        .group-remark-outer {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 6px;
        }
        .group-remark {
            margin: 0 auto 0 auto;
            padding: 6px 4px;
            color: #888;
            font-size: 11px;
            background: none;
            border-radius: 0;
            box-shadow: none;
            text-align: left;
            max-width: 260px;
            width: 100%;
        }
        @media (max-width: 600px) {
            .group-members.fixed-layout {
                gap: 7px;
            }
            .member-chip.fixed-chip {
                min-width: 100px;
                max-width: 100%;
                font-size: 12px;
                padding: 6px 4px;
            }
            .group-remark {
                max-width: 98vw;
                font-size: 12px;
                padding: 6px 4px;
            }
        }
        .group-result-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin: 8px 0 0 0;
            max-width: 340px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        .group-table-card {
            background: #fff;
            border-radius: 7px;
            box-shadow: 0 1px 4px rgba(44,62,80,0.08);
            padding: 4px 2px 4px 2px;
            margin-bottom: 0;
            width: 100%;
            overflow-x: auto;
        }
        .group-table-title {
            font-size: 12px;
            font-weight: 700;
            color: #38d39f;
            margin-bottom: 2px;
            text-align: left;
            padding-left: 2px;
        }
        .group-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            table-layout: fixed;
        }
        .group-table td {
            border: none;
            padding: 2px 2px;
            text-align: center;
            word-break: break-all;
        }
        .group-td-pos {
            color: #007bff;
            font-weight: 600;
            width: 32%;
            text-align: left;
        }
        .group-td-name {
            color: #38d39f;
            font-weight: 700;
            width: 34%;
            text-align: center;
        }
        .group-td-hero {
            color: #ff9800;
            font-weight: 600;
            width: 34%;
            text-align: right;
        }
        .group-td-other {
            color: #888;
            font-size: 10px;
            text-align: center;
        }
        .group-remark-outer {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 4px;
        }
        .group-remark {
            margin: 0 auto 0 auto;
            padding: 2px 2px;
            color: #888;
            font-size: 10px;
            background: none;
            border-radius: 0;
            box-shadow: none;
            text-align: left;
            max-width: 180px;
            width: 100%;
        }
        .remark-line {
            margin-bottom: 1px;
            color: #aaa;
            font-size: 10px;
            font-style: italic;
            letter-spacing: 0.1px;
        }
        @media (max-width: 600px) {
            .modal-content {
                width: 99vw !important;
                max-width: 99vw !important;
                min-width: 0 !important;
                border-radius: 0 0 8px 8px;
            }
            .group-result-container {
                max-width: 99vw;
                gap: 3px;
                margin: 4px 0 0 0;
            }
            .group-table-card {
                padding: 2px 0 2px 0;
                border-radius: 5px;
            }
            .group-table-title { font-size: 10px; margin-bottom: 1px; }
            .group-table { font-size: 9px; }
            .group-table td { padding: 1px 1px; }
            .group-td-pos, .group-td-name, .group-td-hero { font-size: 9px; }
            .group-remark {
                max-width: 90vw;
                font-size: 8px;
                padding: 1px 1px;
            }
            .remark-line {
                font-size: 8px;
                margin-bottom: 0;
            }
        }
        /* ‰ºòÂåñuser/heroÂÜÖÊåâÈíÆÊéíÁâà‰∏éÂ§ßÂ∞è */
        .form-section-header .add-item-btn {
            margin-left: 12px;
            padding: 6px 16px;
            font-size: 14px;
            border-radius: 7px;
        }
        .form-group .add-item-btn {
            margin-top: 0;
            margin-left: 8px;
            padding: 5px 12px;
            font-size: 13px;
            border-radius: 7px;
        }
        .list-item .remove-item-btn {
            margin-left: auto;
            padding: 4px 10px;
            font-size: 12px;
            border-radius: 7px;
            align-self: flex-end;
        }
        .hero-item .remove-item-btn {
            margin-left: 10px;
            padding: 5px 12px;
            font-size: 13px;
            border-radius: 7px;
        }
        .modal-buttons button, .toggle-edit-btn, .toggle-view-btn {
            border-radius: 9px;
            font-size: 15px;
            padding: 10px 0;
        }
        @media (max-width: 600px) {
            .form-section-header .add-item-btn {
                width: 100%;
                margin: 6px 0 0 0;
                padding: 10px 0;
                font-size: 15px;
                border-radius: 8px;
            }
            .form-group .add-item-btn {
                width: 100%;
                margin: 4px 0 0 0;
                padding: 8px 0;
                font-size: 14px;
                border-radius: 8px;
            }
            .list-item .remove-item-btn {
                width: 60px;
                margin-left: 6px;
                padding: 6px 0;
                font-size: 13px;
                border-radius: 8px;
            }
            .hero-item .remove-item-btn {
                width: 60px;
                margin-left: 6px;
                padding: 7px 0;
                font-size: 14px;
                border-radius: 8px;
            }
            .modal-buttons button, .toggle-edit-btn, .toggle-view-btn {
                border-radius: 10px;
                font-size: 16px;
                padding: 12px 0;
            }
        }
        /* ÁºñËæëÊ®°ÂºèÊ®™ÂêëÁ¥ßÂáëÊéíÂàó */
        .form-section-content.edit-compact {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 6px;
            align-items: flex-start;
        }
        .hero-item-simple.edit-compact, .list-item.edit-compact {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 4px;
            min-width: 0;
            flex: 1 1 0;
            padding: 4px 2px;
            margin: 0;
        }
        .hero-item-simple.edit-compact input,
        .list-item.edit-compact input {
            width: 70px;
            min-width: 0;
            font-size: 12px;
            padding: 4px 4px;
        }
        .hero-item-simple.edit-compact .remove-item-btn,
        .list-item.edit-compact .remove-item-btn {
            width: 44px;
            font-size: 12px;
            padding: 4px 0;
            border-radius: 7px;
        }
        @media (max-width: 600px) {
            .form-section-content.edit-compact {
                gap: 2px;
            }
            .hero-item-simple.edit-compact, .list-item.edit-compact {
                gap: 2px;
                padding: 2px 0;
            }
            .hero-item-simple.edit-compact input,
            .list-item.edit-compact input {
                width: 48px;
                font-size: 11px;
                padding: 2px 2px;
            }
            .hero-item-simple.edit-compact .remove-item-btn,
            .list-item.edit-compact .remove-item-btn {
                width: 32px;
                font-size: 11px;
                padding: 2px 0;
            }
        }
        /* Êü•ÁúãÊ®°ÂºèÂàÜÁªÑÊõ¥ÊòéÊòæ */
        .form-section-content.view-compact {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .hero-item-simple.view-compact, .list-item.view-compact {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 6px 8px;
            font-size: 13px;
            margin-bottom: 2px;
            display: flex;
            flex-direction: row;
            gap: 8px;
            align-items: center;
        }
        @media (max-width: 600px) {
            html, body {
                font-size: 13px;
                padding: 0;
                margin: 0;
                overflow-x: hidden;
            }
            .header {
                gap: 6px;
                margin-bottom: 10px;
            }
            .logo-circle {
                width: 24px;
                height: 24px;
                font-size: 1rem;
            }
            h1 {
                font-size: 17px;
                margin-bottom: 10px;
            }
            .button-container {
                margin-top: 10px;
                gap: 10px;
            }
            .modal-content {
                width: 99vw !important;
                max-width: 99vw !important;
                min-width: 0 !important;
                border-radius: 0 0 8px 8px;
                padding: 0;
                box-shadow: 0 2px 8px rgba(44,62,80,0.10);
            }
            .modal-header {
                padding: 6px 4px;
                font-size: 13px;
            }
            .modal-header h2 {
                font-size: 13px;
            }
            .modal-body {
                padding: 6px 2px;
                max-height: 80vh;
            }
            .form-section {
                margin-bottom: 8px;
                border-radius: 6px;
                padding: 0;
            }
            .form-section-header {
                padding: 6px 6px;
                font-size: 13px;
                border-radius: 6px 6px 0 0;
            }
            .form-section-content, .form-section-content.edit-compact, .form-section-content.view-compact {
                padding: 6px 2px;
                border-radius: 0 0 6px 6px;
                gap: 2px;
            }
            .form-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 1px;
                margin-bottom: 6px;
            }
            .form-group label {
                min-width: auto;
                margin-bottom: 1px;
                font-size: 12px;
            }
            .form-group input[type="text"],
            .form-group input[type="number"],
            .form-group select,
            .form-group textarea {
                font-size: 12px;
                padding: 4px 6px;
                border-radius: 3px;
            }
            .form-group textarea {
                min-height: 36px;
            }
            .add-item-btn, .remove-item-btn {
                font-size: 11px;
                padding: 5px 8px;
                border-radius: 6px;
                margin-top: 1px;
            }
            .list-container {
                margin-top: 1px;
            }
            .list-items {
                margin-bottom: 1px;
            }
            .list-item, .list-item.edit-compact, .list-item.view-compact {
                margin-bottom: 2px;
                padding: 2px;
                border-radius: 3px;
                font-size: 12px;
            }
            .list-item input[type="text"] {
                font-size: 11px;
                padding: 3px 4px;
                border-radius: 2px;
            }
            .hero-item, .hero-item-simple, .hero-item-simple.edit-compact, .hero-item-simple.view-compact {
                padding: 5px 2px;
                border-radius: 5px;
                margin-bottom: 4px;
                font-size: 12px;
            }
            .hero-item-header {
                margin-bottom: 3px;
            }
            .hero-item-title {
                font-size: 12px;
            }
            .tab-header {
                font-size: 12px;
                margin-bottom: 6px;
                border-radius: 6px 6px 0 0;
                gap: 2px;
            }
            .tab-button {
                padding: 6px 8px;
                font-size: 12px;
                border-radius: 6px 6px 0 0;
                margin-right: 2px;
            }
            .tab-content {
                padding: 6px 2px 2px 2px;
                border-radius: 0 0 6px 6px;
                margin-bottom: 4px;
            }
            .hero-grid {
                gap: 4px;
                padding: 4px 2px;
                border-radius: 6px;
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }
            .modal-buttons {
                flex-direction: column-reverse;
                gap: 4px;
                padding-top: 4px;
            }
            .modal-buttons button, .toggle-edit-btn, .toggle-view-btn {
                width: 100%;
                padding: 8px 0;
                font-size: 14px;
                border-radius: 7px;
            }
            .edit-mode-toggle {
                flex-direction: column;
                gap: 5px;
            }
            .mode-switch {
                width: 100%;
                justify-content: center;
                gap: 5px;
                padding: 2px 0;
            }
            .close {
                font-size: 16px;
                width: 24px;
                height: 24px;
            }
            .group-result-container, .group-table-card, .group-table-title, .group-table, .group-table td, .group-td-pos, .group-td-name, .group-td-hero, .group-td-other, .group-remark, .remark-line {
                font-size: 10px !important;
                padding: 1px 1px !important;
                border-radius: 4px !important;
            }
        }
        .edit-modal-footer {
            position: sticky;
            position: -webkit-sticky;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            box-shadow: 0 -2px 12px rgba(44,62,80,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 32px;
            padding: 14px 28px 14px 28px;
            z-index: 10;
            border-radius: 0 0 12px 12px;
        }
        .edit-modal-footer .cancel-btn {
            background: #f4f8fb;
            color: #888;
            border: 1.5px solid #e3e8ee;
            font-weight: 600;
            min-width: 100px;
            font-size: 17px;
            border-radius: 9px;
            padding: 12px 0;
            margin-right: auto;
        }
        .edit-modal-footer .save-btn {
            background: linear-gradient(90deg, #38d39f 0%, #4f8cff 100%);
            color: #fff;
            border: none;
            font-weight: 700;
            min-width: 120px;
            font-size: 18px;
            border-radius: 9px;
            padding: 14px 0;
            margin-left: auto;
        }
        @media (max-width: 600px) {
            .edit-modal-footer {
                padding: 8px 4px 8px 4px;
                gap: 8px;
                border-radius: 0 0 8px 8px;
            }
            .edit-modal-footer .cancel-btn, .edit-modal-footer .save-btn {
                width: 48vw;
                min-width: 0;
                font-size: 15px;
                padding: 10px 0;
                border-radius: 8px;
            }
        }
    </style>
</head>
<body>
<!-- È°∂ÈÉ®LOGO‰∏éÊ†áÈ¢òÂå∫ -->
<div class="header">
    <div class="logo-circle">G</div>
    <h1>GAGA GAME</h1>
</div>
<div class="button-container">
    <!-- ÈÖçÁΩÆÊåâÈíÆË°å -->
    <div class="button-row">
        <button class="config-button" onclick="urlRequest('/gagaFamily/conf/heroYaml', true, 'hero')">Ëã±ÈõÑ</button>
        <button class="config-button" onclick="urlRequest('/gagaFamily/conf/userYaml', true, 'user')">Áî®Êà∑</button>
    </div>
    <!-- ÂàÜÁªÑÊåâÈíÆË°å -->
    <div class="button-row">
        <button class="group-button" onclick="urlRequest('/gagaFamily/group/getGroup')">ÂàÜÁªÑ</button>
    </div>
</div>

<!-- ‰ºòÂåñÂêéÁöÑÂºπÁ™óHTML -->
<div id="yamlModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">ÈÖçÁΩÆÂÜÖÂÆπ</h2>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="edit-mode-toggle">
                <div>
                    <span id="modeIndicator">Êü•ÁúãÊ®°Âºè</span>
                </div>
                <div class="mode-switch">
                    <button id="toggleFormBtn" class="toggle-view-btn" onclick="setViewMode('form')">Ë°®Âçï</button>
                    <button id="toggleYamlBtn" class="toggle-view-btn" onclick="setViewMode('yaml')">YAML</button>
                    <button id="toggleEditBtn" class="toggle-edit-btn" onclick="toggleEditMode()">ÁºñËæë</button>
                </div>
            </div>

            <!-- YAMLÊü•ÁúãÂÆπÂô® -->
            <div id="yamlViewContainer">
                <pre id="yamlContent" class="yaml-content"></pre>
            </div>

            <!-- YAMLÁºñËæëÂÆπÂô® -->
            <div id="yamlEditContainer" style="display: none;">
                <label for="yamlEditor"></label><textarea id="yamlEditor" class="yaml-editor" placeholder="Âú®Ê≠§ÁºñËæëYAMLÈÖçÁΩÆ..."></textarea>
                <div class="modal-buttons">
                    <button class="cancel-btn" onclick="cancelEdit()">ÂèñÊ∂à</button>
                    <button class="save-btn" onclick="saveChanges()">‰øùÂ≠ò</button>
                </div>
            </div>

            <!-- Ë°®ÂçïÊü•ÁúãÂÆπÂô® -->
            <div id="formViewContainer" style="display: none;">
                <div id="formContent" class="form-container">
                    <!-- Ë°®ÂçïÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>

            <!-- Ë°®ÂçïÁºñËæëÂÆπÂô® -->
            <div id="formEditContainer" style="display: none;">
                <form id="configForm" class="form-container">
                    <!-- Ë°®ÂçïÁºñËæëÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                </form>
                <div class="modal-buttons">
                    <button class="cancel-btn" onclick="cancelEdit()">ÂèñÊ∂à</button>
                    <button class="save-btn" onclick="saveFormChanges()">‰øùÂ≠ò</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ÂàÜÁªÑÁªìÊûúÂºπÁ™ó -->
<div id="groupResultModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ÂàÜÁªÑÁªìÊûú</h2>
            <span class="close" onclick="closeGroupResultModal()">&times;</span>
        </div>
        <div class="modal-body" id="groupResultBody">
            <!-- ÂàÜÁªÑÁªìÊûúÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÂä†ËΩΩ -->
        </div>
    </div>
</div>

<script>
    // ÂÖ®Â±ÄÈÖçÁΩÆÂèòÈáè
    const API_BASE_URL = 'http://127.0.0.1:8008';

    // Â∫îÁî®Áä∂ÊÄÅÂèòÈáè
    let originalYamlContent = '';
    let currentEditMode = false;
    let currentViewMode = 'form'; // 'yaml' Êàñ 'form'
    let currentConfigType = '';
    let configData = {};

    // Êñ∞Â¢ûÔºöÂÖ®Â±ÄËã±ÈõÑÂàÜË∑Ø-Ëã±ÈõÑÊ±†ÁºìÂ≠ò
    let heroLaneMap = null;

    // ‰øÆÊîπurlRequestÔºåÂºπÂá∫userÈÖçÁΩÆÁºñËæëÊó∂ÔºåÈ¢ÑÂä†ËΩΩhero.yaml
    function urlRequest(url, isYaml = false, configType = '') {
        const apiUrl = API_BASE_URL + url;
        // Â¶ÇÊûúÊòØuserÈÖçÁΩÆÔºåÂÖàÂä†ËΩΩhero.yaml
        if (configType === 'user') {
            fetch(API_BASE_URL + '/gagaFamily/conf/heroYaml')
                .then(res => res.text())
                .then(heroYaml => {
                    heroLaneMap = parseHeroYamlToLaneMap(heroYaml);
                    fetch(apiUrl)
                        .then(response => {
                            if (!response.ok) throw new Error('ÁΩëÁªúÂìçÂ∫îÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†ÅÔºö' + response.status);
                            return response.text();
                        })
                        .then(data => {
                            if (isYaml) {
                                showYamlModal(data, configType);
                            } else {
                                alert(data);
                            }
                        })
                        .catch(error => alert('ËØ∑Ê±ÇÂ§±Ë¥•Ôºö' + error.message));
                });
        } else {
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error('ÁΩëÁªúÂìçÂ∫îÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†ÅÔºö' + response.status);
                    return response.text();
                })
                .then(data => {
                    if (isYaml) {
                        showYamlModal(data, configType);
                    } else {
                        alert(data);
                    }
                })
                .catch(error => alert('ËØ∑Ê±ÇÂ§±Ë¥•Ôºö' + error.message));
        }
    }
    // Ëß£Êûêhero.yaml‰∏∫ÂàÜË∑Ø-Ëã±ÈõÑÊ±†map
    function parseHeroYamlToLaneMap(yamlText) {
        const lines = yamlText.split('\n');
        const map = {};
        let currentLane = null;
        lines.forEach(line => {
            if (/^[^\s].*:$/.test(line)) {
                currentLane = line.replace(':', '').trim();
                map[currentLane] = [];
            } else if (/^\s*-\s*/.test(line) && currentLane) {
                const hero = line.replace(/^\s*-\s*/, '').trim();
                if (hero) map[currentLane].push(hero);
            }
        });
        return map;
    }

    function showYamlModal(yamlContent, configType) {
        originalYamlContent = yamlContent;
        currentConfigType = configType;

        try {
            // ÁÆÄÂçïÁöÑYAMLËß£ÊûêÔºà‰ªÖÊîØÊåÅÂü∫Êú¨ÁªìÊûÑÔºâ
            configData = parseSimpleYaml(yamlContent);
        } catch (error) {
            console.error('YAMLËß£ÊûêÈîôËØØ:', error);
            configData = {};
        }

        document.getElementById('yamlContent').textContent = yamlContent;
        document.getElementById('yamlEditor').value = yamlContent;

        // Êõ¥Êñ∞Ê®°ÊÄÅÊ°ÜÊ†áÈ¢ò
        const title = configType === 'hero' ? 'Ëã±ÈõÑÈÖçÁΩÆ' :
            configType === 'user' ? 'Áî®Êà∑ÈÖçÁΩÆ' : 'ÈÖçÁΩÆÂÜÖÂÆπ';
        document.getElementById('modalTitle').textContent = title;

        document.getElementById('yamlModal').style.display = 'block';
        setEditMode(false);
        setViewMode('form');

        // ÈòªÊ≠¢È°µÈù¢ÊªöÂä®
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        document.getElementById('yamlModal').style.display = 'none';
        // ÊÅ¢Â§çÈ°µÈù¢ÊªöÂä®
        document.body.style.overflow = 'auto';
    }

    function setViewMode(mode) {
        currentViewMode = mode;
        // ÈöêËóèÊâÄÊúâÂÆπÂô®
        document.getElementById('yamlViewContainer').style.display = 'none';
        document.getElementById('yamlEditContainer').style.display = 'none';
        document.getElementById('formViewContainer').style.display = 'none';
        document.getElementById('formEditContainer').style.display = 'none';
        // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
        document.getElementById('toggleFormBtn').className = mode === 'form' ? 'toggle-edit-btn' : 'toggle-view-btn';
        document.getElementById('toggleYamlBtn').className = mode === 'yaml' ? 'toggle-edit-btn' : 'toggle-view-btn';
        // Ê®°ÂºèÊèêÁ§∫
        const indicator = document.getElementById('modeIndicator');
        if (currentEditMode) {
            indicator.innerHTML = '<span class="mode-indicator edit"><span class="mode-icon">‚úèÔ∏è</span> ÂΩìÂâç‰∏∫ÁºñËæëÊ®°Âºè</span>';
        } else {
            indicator.innerHTML = '<span class="mode-indicator view"><span class="mode-icon">üîç</span> ÂΩìÂâç‰∏∫Êü•ÁúãÊ®°Âºè</span>';
        }
        if (currentEditMode) {
            // ÁºñËæëÊ®°Âºè
            if (mode === 'form') {
                generateFormEdit();
                document.getElementById('formEditContainer').style.display = 'block';
            } else {
                document.getElementById('yamlEditContainer').style.display = 'block';
            }
        } else {
            // Êü•ÁúãÊ®°Âºè
            if (mode === 'form') {
                generateFormView();
                document.getElementById('formViewContainer').style.display = 'block';
            } else {
                document.getElementById('yamlViewContainer').style.display = 'block';
            }
        }
    }

    function toggleEditMode() {
        setEditMode(!currentEditMode);
    }

    function setEditMode(editMode) {
        currentEditMode = editMode;
        // ÁºñËæëÊåâÈíÆÊñáÊú¨Âíåicon
        const editBtn = document.getElementById('toggleEditBtn');
        if (editBtn) {
            editBtn.innerHTML = editMode ? 'Êü•Áúã <span class="mode-icon">üîç</span>' : 'ÁºñËæë <span class="mode-icon">‚úèÔ∏è</span>';
        }
        setViewMode(currentViewMode);

        // Âè™Âú®ÁºñËæëÊ®°Âºè‰∏ãÊèíÂÖ•footer
        let footer = document.getElementById('editModalFooter');
        if (editMode) {
            if (!footer) {
                footer = document.createElement('div');
                footer.id = 'editModalFooter';
                footer.className = 'edit-modal-footer';
                footer.innerHTML = `
                    <button class="cancel-btn" onclick="cancelEdit()">ÂèñÊ∂à</button>
                    <button class="save-btn" onclick="${currentViewMode === 'form' ? 'saveFormChanges()' : 'saveChanges()'}">‰øùÂ≠ò</button>
                `;
                document.querySelector('.modal-content').appendChild(footer);
            } else {
                footer.style.display = '';
            }
        } else {
            if (footer) footer.style.display = 'none';
        }
    }

    function generateFormView() {
        const container = document.getElementById('formContent');
        container.innerHTML = '';

        if (currentConfigType === 'hero') {
            generateHeroFormView(container);
        } else if (currentConfigType === 'user') {
            generateUserFormView(container);
        } else {
            container.innerHTML = '<p>Êú™Áü•ÈÖçÁΩÆÁ±ªÂûã</p>';
        }
    }

    function generateFormEdit() {
        const container = document.getElementById('configForm');
        container.innerHTML = '';

        if (currentConfigType === 'hero') {
            generateHeroFormEdit(container);
        } else if (currentConfigType === 'user') {
            generateUserFormEdit(container);
        } else {
            container.innerHTML = '<p>Êú™Áü•ÈÖçÁΩÆÁ±ªÂûã</p>';
        }
    }

    function generateHeroFormView(container) {
        if (!configData.heroes || !Array.isArray(configData.heroes)) {
            container.innerHTML = '<p>Ê≤°ÊúâÊâæÂà∞Ëã±ÈõÑÊï∞ÊçÆ</p>';
            return;
        }

        // Êåâ‰ΩçÁΩÆÂàÜÁ±ªËã±ÈõÑ
        const positionGroups = {};
        configData.heroes.forEach(hero => {
            const position = hero.type || 'Êú™ÂàÜÁ±ª';
            if (!positionGroups[position]) {
                positionGroups[position] = [];
            }
            positionGroups[position].push(hero.name);
        });

        // ÂàõÂª∫ÈÄâÈ°πÂç°ÂÆπÂô®
        const tabContainer = document.createElement('div');
        tabContainer.className = 'tab-container';
        container.appendChild(tabContainer);

        // ÂàõÂª∫ÈÄâÈ°πÂç°Ê†áÈ¢òÊ†è
        const tabHeader = document.createElement('div');
        tabHeader.className = 'tab-header';
        tabContainer.appendChild(tabHeader);

        // ÂàõÂª∫ÈÄâÈ°πÂç°ÂÜÖÂÆπÂå∫Âüü
        const positions = Object.keys(positionGroups);
        positions.forEach((position, index) => {
            // ÂàõÂª∫ÈÄâÈ°πÂç°ÊåâÈíÆ
            const tabButton = document.createElement('div');
            tabButton.className = `tab-button ${index === 0 ? 'active' : ''}`;
            tabButton.textContent = position;
            tabButton.onclick = function() {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // ËÆæÁΩÆÂΩìÂâçÈÄâÈ°πÂç°‰∏∫Ê¥ªÂä®Áä∂ÊÄÅ
                this.classList.add('active');
                document.getElementById(`tab-content-${position}`).classList.add('active');
            };
            tabHeader.appendChild(tabButton);

            // ÂàõÂª∫ÈÄâÈ°πÂç°ÂÜÖÂÆπ
            const tabContent = document.createElement('div');
            tabContent.className = `tab-content ${index === 0 ? 'active' : ''}`;
            tabContent.id = `tab-content-${position}`;
            tabContainer.appendChild(tabContent);

            // ÂàõÂª∫Ëã±ÈõÑÁΩëÊ†º
            const heroGrid = document.createElement('div');
            heroGrid.className = 'hero-grid';
            tabContent.appendChild(heroGrid);

            // Ê∑ªÂä†Ëã±ÈõÑ
            positionGroups[position].forEach(heroName => {
                const heroDiv = document.createElement('div');
                heroDiv.className = 'hero-item-simple';
                heroDiv.textContent = heroName;
                heroGrid.appendChild(heroDiv);
            });
        });

        // Â¶ÇÊûúÊ≤°ÊúâÂàÜÁ±ªÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
        if (positions.length === 0) {
            container.innerHTML = '<p>Ê≤°ÊúâÊâæÂà∞Ëã±ÈõÑÊï∞ÊçÆ</p>';
        }
    }

    function generateHeroFormEdit(container) {
        if (!configData.heroes) {
            configData.heroes = [];
        }

        // Êåâ‰ΩçÁΩÆÂàÜÁ±ªËã±ÈõÑ
        const positionGroups = {};
        configData.heroes.forEach(hero => {
            const position = hero.type || 'Êú™ÂàÜÁ±ª';
            if (!positionGroups[position]) {
                positionGroups[position] = [];
            }
            positionGroups[position].push(hero.name);
        });

        // ÂàõÂª∫ÈÄâÈ°πÂç°ÂÆπÂô®
        const tabContainer = document.createElement('div');
        tabContainer.className = 'tab-container';
        container.appendChild(tabContainer);

        // ÂàõÂª∫ÈÄâÈ°πÂç°Ê†áÈ¢òÊ†è
        const tabHeader = document.createElement('div');
        tabHeader.className = 'tab-header';
        tabContainer.appendChild(tabHeader);

        // ÂÆö‰πâÊ†áÂáÜ‰ΩçÁΩÆ
        const standardPositions = ['ÂØπÊäóË∑Ø', 'ÊâìÈáé', '‰∏≠Ë∑Ø', 'ÂèëËÇ≤Ë∑Ø', 'Ê∏∏Ëµ∞'];

        // Á°Æ‰øùÊâÄÊúâÁé∞Êúâ‰ΩçÁΩÆÈÉΩÊúâÂØπÂ∫îÁöÑÂàÜÁªÑ
        Object.keys(positionGroups).forEach(position => {
            // Â∑≤ÁªèÂ≠òÂú®ÁöÑ‰ΩçÁΩÆÂàÜÁªÑ‰øùÊåÅ‰∏çÂèò
        });

        // Á°Æ‰øùÊ†áÂáÜ‰ΩçÁΩÆÈÉΩÊúâÂØπÂ∫îÁöÑÂàÜÁªÑ
        standardPositions.forEach(position => {
            if (!positionGroups[position]) {
                positionGroups[position] = [];
            }
        });

        // ÂàõÂª∫ÈÄâÈ°πÂç°ÂÜÖÂÆπÂå∫Âüü
        const positions = [];
        // ÂÖàÊ∑ªÂä†Ê†áÂáÜ‰ΩçÁΩÆ
        standardPositions.forEach(pos => {
            if (positionGroups[pos] && positionGroups[pos].length > 0) {
                positions.push(pos);
            }
        });
        // Â¶ÇÊûúÊúâÈùûÊ†áÂáÜ‰ΩçÁΩÆ‰∏îÊúâËã±ÈõÑÔºå‰πüÊ∑ªÂä†ËøõÊù•
        Object.keys(positionGroups).forEach(pos => {
            if (!standardPositions.includes(pos) && positionGroups[pos].length > 0 && !positions.includes(pos)) {
                positions.push(pos);
            }
        });
        positions.forEach((position, index) => {
            // ÂàõÂª∫ÈÄâÈ°πÂç°ÊåâÈíÆ
            const tabButton = document.createElement('div');
            tabButton.className = `tab-button ${index === 0 ? 'active' : ''}`;
            tabButton.textContent = position;
            tabButton.onclick = function() {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // ËÆæÁΩÆÂΩìÂâçÈÄâÈ°πÂç°‰∏∫Ê¥ªÂä®Áä∂ÊÄÅ
                this.classList.add('active');
                document.getElementById(`tab-edit-content-${position}`).classList.add('active');
            };
            tabHeader.appendChild(tabButton);

            // ÂàõÂª∫ÈÄâÈ°πÂç°ÂÜÖÂÆπ
            const tabContent = document.createElement('div');
            tabContent.className = `tab-content ${index === 0 ? 'active' : ''}`;
            tabContent.id = `tab-edit-content-${position}`;
            tabContainer.appendChild(tabContent);

            // Ê∑ªÂä†Ê†áÈ¢òÂíåÊ∑ªÂä†ÊåâÈíÆ
            const headerDiv = document.createElement('div');
            headerDiv.className = 'form-section-header';
            headerDiv.innerHTML = `
                <span>${position}Ëã±ÈõÑ</span>
                <button type="button" class="add-item-btn" onclick="addHeroToPosition('${position}')">Ê∑ªÂä†Ëã±ÈõÑ</button>
            `;
            tabContent.appendChild(headerDiv);

            // ÂàõÂª∫Ëã±ÈõÑÂàóË°®Âå∫Âüü
            const heroListDiv = document.createElement('div');
            heroListDiv.className = 'form-section-content';
            heroListDiv.id = `heroEditList-${position}`;
            tabContent.appendChild(heroListDiv);

            // Ê∑ªÂä†ËØ•‰ΩçÁΩÆÁöÑÊâÄÊúâËã±ÈõÑ
            const positionHeroes = configData.heroes.filter(hero => hero.type === position);
            positionHeroes.forEach(hero => {
                const heroDiv = document.createElement('div');
                heroDiv.className = 'hero-item-simple';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = hero.name;
                nameInput.placeholder = 'ËæìÂÖ•Ëã±ÈõÑÂêçÁß∞';
                nameInput.dataset.position = position;
                nameInput.dataset.originalName = hero.name;
                nameInput.className = 'hero-name-input';
                nameInput.name = `heroName-${position}-${hero.name}`;
                nameInput.addEventListener('change', function() {
                    updateHeroName(hero.name, this.value, position);
                    this.dataset.originalName = this.value;
                });

                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'remove-item-btn';
                removeBtn.title = 'Âà†Èô§';
                removeBtn.innerHTML = '<span class="remove-icon">üóëÔ∏è</span>';
                removeBtn.addEventListener('click', function() {
                    removeHeroFromPosition(hero.name, position);
                    heroDiv.remove();
                });

                heroDiv.appendChild(nameInput);
                heroDiv.appendChild(removeBtn);
                heroListDiv.appendChild(heroDiv);
            });
        });
    }

    function removeHeroItem(index) {
        configData.heroes.splice(index, 1);
        // ‰∏çÂÜçÈáçÊñ∞ÁîüÊàêÊï¥‰∏™Ë°®ÂçïÔºåËÄåÊòØËÆ©Ë∞ÉÁî®ËÄÖÂ§ÑÁêÜDOMÊõ¥Êñ∞
        // generateFormEdit(); // ÈáçÊñ∞ÁîüÊàêË°®Âçï
    }

    function addHeroToPosition(position) {
        if (!configData.heroes) {
            configData.heroes = [];
        }

        // ÂàõÂª∫Êñ∞Ëã±ÈõÑÂØπË±°
        const newHero = {
            name: '',
            type: position,
            skill: '',
            description: ''
        };

        // Ê∑ªÂä†Âà∞ÈÖçÁΩÆÊï∞ÊçÆ
        configData.heroes.push(newHero);

        // Ëé∑ÂèñËØ•‰ΩçÁΩÆÁöÑËã±ÈõÑÂàóË°®ÂÆπÂô®
        const heroListDiv = document.getElementById(`heroEditList-${position}`);

        // ÂàõÂª∫Êñ∞Ëã±ÈõÑÂÖÉÁ¥†
        const heroDiv = document.createElement('div');
        heroDiv.className = 'hero-item-simple';

        // ÂàõÂª∫ÂêçÁß∞ËæìÂÖ•Ê°Ü
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.value = '';
        nameInput.placeholder = 'ËæìÂÖ•Ëã±ÈõÑÂêçÁß∞';
        nameInput.dataset.position = position;
        nameInput.dataset.originalName = '';
        nameInput.className = 'hero-name-input';
        nameInput.addEventListener('change', function() {
            updateHeroName(this.dataset.originalName, this.value, position);
            this.dataset.originalName = this.value;
        });

        // ÂàõÂª∫Âà†Èô§ÊåâÈíÆ
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'remove-item-btn';
        removeBtn.title = 'Âà†Èô§';
        removeBtn.innerHTML = '<span class="remove-icon">üóëÔ∏è</span>';
        removeBtn.addEventListener('click', function() {
            removeHeroFromPosition(nameInput.value, position);
            heroDiv.remove();
        });

        // ÁªÑË£ÖÂπ∂Ê∑ªÂä†Âà∞ÂÆπÂô®
        heroDiv.appendChild(nameInput);
        heroDiv.appendChild(removeBtn);
        heroListDiv.appendChild(heroDiv);

        // ËÅöÁÑ¶Âà∞Êñ∞ÂàõÂª∫ÁöÑËæìÂÖ•Ê°Ü
        nameInput.focus();
    }

    function removeHeroFromPosition(heroName, position) {
        if (!heroName) return;

        // Êü•ÊâæÂπ∂ÁßªÈô§Ëã±ÈõÑ
        const index = configData.heroes.findIndex(hero =>
            hero.name === heroName && hero.type === position);

        if (index !== -1) {
            configData.heroes.splice(index, 1);
        }
    }

    function updateHeroName(oldName, newName, position) {
        if (!newName) return;

        // Êü•ÊâæÂπ∂Êõ¥Êñ∞Ëã±ÈõÑÂêçÁß∞
        const hero = configData.heroes.find(hero =>
            hero.name === oldName && hero.type === position);

        if (hero) {
            hero.name = newName;
        }
    }

    function generateUserFormView(container) {
        // Áî®Êà∑ÈÖçÁΩÆÁöÑË°®ÂçïËßÜÂõæÁîüÊàêÈÄªËæë
        if (!configData.users || !Array.isArray(configData.users)) {
            container.innerHTML = '<p>Ê≤°ÊúâÊâæÂà∞Áî®Êà∑Êï∞ÊçÆ</p>';
            return;
        }

        let html = '<div class="form-section">';
        html += '<div class="form-section-header">';
        html += '<span>Áî®Êà∑ÈÖçÁΩÆ</span>';
        html += '<span>ÂÖ± ' + configData.users.length + ' ‰∏™Áî®Êà∑</span>';
        html += '</div>';
        html += '<div class="form-section-content">';

        configData.users.forEach((user, index) => {
            html += '<div class="hero-item">';
            html += '<div class="hero-item-header">';
            html += '<div class="hero-item-title">Áî®Êà∑: ' + (user.name || 'Êú™ÂëΩÂêç') + '</div>';
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label>Áî®Êà∑Âêç:</label>';
            html += '<span>' + (user.name || 'Êú™ËÆæÁΩÆ') + '</span>';
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label>Á¶ÅÁî®Ëã±ÈõÑ:</label>';
            html += '<span>' + (user.banList && user.banList.length > 0 ? user.banList.join(', ') : 'Êó†') + '</span>';
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label>ÊùÉÈáçËã±ÈõÑ:</label>';
            html += '<span>' + (user.weightList && user.weightList.length > 0 ? user.weightList.join(', ') : 'Êó†') + '</span>';
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label>Áé©ÂÆ∂Áä∂ÊÄÅ:</label>';
            html += '<span>' + (user.disable ? 'Â∑≤Á¶ÅÁî®' : 'ÂêØÁî®') + '</span>';
            html += '</div>';

            html += '</div>';
        });

        html += '</div>';
        html += '</div>';

        container.innerHTML = html;
    }

    function generateUserFormEdit(container) {
        // Áî®Êà∑ÈÖçÁΩÆÁöÑË°®ÂçïÁºñËæëÈÄªËæë
        if (!configData.users || !Array.isArray(configData.users)) {
            configData.users = [];
        }

        let html = '<div class="form-section">';
        html += '<div class="form-section-header">';
        html += '<span>Áî®Êà∑ÈÖçÁΩÆÁºñËæë</span>';
        html += '<button type="button" class="add-item-btn" onclick="addNewUser()">Ê∑ªÂä†Áî®Êà∑</button>';
        html += '</div>';
        html += '<div class="form-section-content" id="usersContainer">';

        configData.users.forEach((user, index) => {
            html += generateUserEditItem(user, index);
        });

        html += '</div>';
        html += '</div>';

        container.innerHTML = html;
    }

    function generateUserEditItem(user, index) {
        let html = '<div class="hero-item" data-user-index="' + index + '">';
        html += '<div class="hero-item-header">';
        html += '<div class="hero-item-title">Áî®Êà∑ ' + (index + 1) + '</div>';
        html += '<button type="button" class="remove-item-btn" onclick="removeUser(' + index + ')" title="Âà†Èô§"><span class="remove-icon">üóëÔ∏è</span></button>';
        html += '</div>';
        // Áî®Êà∑ÂêçËæìÂÖ•
        html += '<div class="form-group">';
        html += '<label>Áî®Êà∑Âêç:</label>';
        html += '<input type="text" class="user-name-input" data-user-index="' + index + '" value="' + (user.name || '') + '" placeholder="ËæìÂÖ•Áî®Êà∑Âêç">';
        html += '</div>';
        // Á¶ÅÁî®Áä∂ÊÄÅ
        html += '<div class="form-group">';
        html += '<label>Áé©ÂÆ∂Áä∂ÊÄÅ:</label>';
        html += '<input type="checkbox" class="user-disable-input" data-user-index="' + index + '" ' + (user.disable ? 'checked' : '') + '>';
        html += '<span style="margin-left: 8px;">Á¶ÅÁî®ËØ•Áî®Êà∑</span>';
        html += '</div>';
        // Á¶ÅÁî®Ëã±ÈõÑÂàóË°®
        html += '<div class="form-group">';
        html += '<label>Á¶ÅÁî®Ëã±ÈõÑ:</label>';
        html += '<div class="list-container">';
        html += '<div class="list-items" id="banList-' + index + '">';
        if (user.banList && user.banList.length > 0) {
            user.banList.forEach((hero, heroIndex) => {
                let lane = '';
                let heroName = hero;
                // Â∞ùËØïËá™Âä®Êé®Êñ≠ÂàÜË∑Ø
                if (heroLaneMap) {
                    for (const l in heroLaneMap) {
                        if (heroLaneMap[l].includes(hero)) { lane = l; break; }
                    }
                }
                html += '<div class="list-item edit-compact">';
                html += '<select data-list-type="banLane" data-user-index="' + index + '" data-item-index="' + heroIndex + '" onchange="updateBanHeroSelect(this)">' + renderLaneOptions(lane) + '</select>';
                html += '<select data-list-type="banHero" data-user-index="' + index + '" data-item-index="' + heroIndex + '">' + renderHeroOptions(lane, heroName) + '</select>';
                html += '<button type="button" class="remove-item-btn" onclick="removeListItem(\'banList\', ' + index + ', ' + heroIndex + ')" title="Âà†Èô§"><span class="remove-icon">üóëÔ∏è</span></button>';
                html += '</div>';
            });
        }
        html += '</div>';
        html += '<button type="button" class="add-item-btn" onclick="addListItem(\'banList\', ' + index + ')">Ê∑ªÂä†Á¶ÅÁî®Ëã±ÈõÑ</button>';
        html += '</div>';
        html += '</div>';
        // ÊùÉÈáçËã±ÈõÑÂàóË°®
        html += '<div class="form-group">';
        html += '<label>ÊùÉÈáçËã±ÈõÑ:</label>';
        html += '<div class="list-container">';
        html += '<div class="list-items" id="weightList-' + index + '">';
        if (user.weightList && user.weightList.length > 0) {
            user.weightList.forEach((hero, heroIndex) => {
                let lane = '';
                let heroName = hero;
                let heroWeight = '';
                if (hero.includes('*')) {
                    const arr = hero.split('*');
                    heroName = arr[0];
                    heroWeight = arr[1];
                }
                if (heroLaneMap) {
                    for (const l in heroLaneMap) {
                        if (heroLaneMap[l].includes(heroName)) { lane = l; break; }
                    }
                }
                html += '<div class="list-item edit-compact">';
                html += '<select data-list-type="weightLane" data-user-index="' + index + '" data-item-index="' + heroIndex + '" onchange="updateWeightHeroSelect(this)">' + renderLaneOptions(lane) + '</select>';
                html += '<select data-list-type="weightHero" data-user-index="' + index + '" data-item-index="' + heroIndex + '">' + renderHeroOptions(lane, heroName) + '</select>';
                html += '<span style="margin:0 4px;">*</span>';
                html += '<input type="number" min="1" max="1000" value="' + (heroWeight || '') + '" data-list-type="weightNum" data-user-index="' + index + '" data-item-index="' + heroIndex + '" placeholder="1~1000" style="width:60px;">';
                html += '<button type="button" class="remove-item-btn" onclick="removeListItem(\'weightList\', ' + index + ', ' + heroIndex + ')" title="Âà†Èô§"><span class="remove-icon">üóëÔ∏è</span></button>';
                html += '</div>';
            });
        }
        html += '</div>';
        html += '<button type="button" class="add-item-btn" onclick="addListItem(\'weightList\', ' + index + ')">Ê∑ªÂä†ÊùÉÈáçËã±ÈõÑ</button>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        return html;
    }
    // Ê∏≤ÊüìÂàÜË∑Ø‰∏ãÊãâ
    function renderLaneOptions(selected) {
        if (!heroLaneMap) return '<option value="">ËØ∑ÈÄâÊã©ÂàÜË∑Ø</option>';
        let html = '<option value="">ËØ∑ÈÄâÊã©ÂàÜË∑Ø</option>';
        for (const lane in heroLaneMap) {
            html += `<option value="${lane}"${lane===selected?' selected':''}>${lane}</option>`;
        }
        return html;
    }
    // Ê∏≤ÊüìËã±ÈõÑ‰∏ãÊãâ
    function renderHeroOptions(lane, selected) {
        if (!heroLaneMap || !lane || !heroLaneMap[lane]) return '<option value="">ËØ∑ÈÄâÊã©Ëã±ÈõÑ</option>';
        let html = '<option value="">ËØ∑ÈÄâÊã©Ëã±ÈõÑ</option>';
        heroLaneMap[lane].forEach(hero => {
            html += `<option value="${hero}"${hero===selected?' selected':''}>${hero}</option>`;
        });
        return html;
    }
    // ËÅîÂä®ÔºöÂàÜË∑ØÂèòÂä®Êó∂Âà∑Êñ∞Ëã±ÈõÑ‰∏ãÊãâ
    function updateBanHeroSelect(sel) {
        const lane = sel.value;
        const userIndex = sel.getAttribute('data-user-index');
        const itemIndex = sel.getAttribute('data-item-index');
        const heroSel = document.querySelector(`select[data-list-type='banHero'][data-user-index='${userIndex}'][data-item-index='${itemIndex}']`);
        heroSel.innerHTML = renderHeroOptions(lane, '');
    }
    function updateWeightHeroSelect(sel) {
        const lane = sel.value;
        const userIndex = sel.getAttribute('data-user-index');
        const itemIndex = sel.getAttribute('data-item-index');
        const heroSel = document.querySelector(`select[data-list-type='weightHero'][data-user-index='${userIndex}'][data-item-index='${itemIndex}']`);
        heroSel.innerHTML = renderHeroOptions(lane, '');
    }

    function addNewUser() {
        if (!configData.users) {
            configData.users = [];
        }

        const newUser = {
            name: "",
            banList: [],
            weightList: [],
            disable: false
        };

        configData.users.push(newUser);

        // ‰∏çÂÜçÈáçÊñ∞ÁîüÊàêÊï¥‰∏™Ë°®ÂçïÔºåËÄåÊòØÁõ¥Êé•Ê∑ªÂä†Êñ∞Áî®Êà∑È°πÂà∞DOM
        const usersContainer = document.getElementById('usersContainer');
        const userIndex = configData.users.length - 1;
        const userHtml = generateUserEditItem(newUser, userIndex);

        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = userHtml;
        const userElement = tempDiv.firstChild;
        usersContainer.appendChild(userElement);

        // ËÅöÁÑ¶Âà∞Êñ∞Áî®Êà∑ÁöÑÂêçÁß∞ËæìÂÖ•Ê°Ü
        const nameInput = userElement.querySelector('.user-name-input');
        if (nameInput) {
            nameInput.focus();
        }
    }

    function removeUser(userIndex) {
        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Áî®Êà∑ÂêóÔºü')) {
            configData.users.splice(userIndex, 1);

            // ‰∏çÂÜçÈáçÊñ∞ÁîüÊàêÊï¥‰∏™Ë°®ÂçïÔºåËÄåÊòØÁõ¥Êé•ÁßªÈô§Áî®Êà∑ÂÖÉÁ¥†
            const userElement = document.querySelector(`[data-user-index="${userIndex}"]`);
            if (userElement) {
                userElement.remove();
            }

            // Êõ¥Êñ∞Ââ©‰ΩôÁî®Êà∑ÂÖÉÁ¥†ÁöÑÁ¥¢Âºï
            const remainingUsers = document.querySelectorAll('[data-user-index]');
            remainingUsers.forEach((element, index) => {
                const currentIndex = parseInt(element.getAttribute('data-user-index'));
                if (currentIndex > userIndex) {
                    element.setAttribute('data-user-index', currentIndex - 1);
                    // Êõ¥Êñ∞ÊâÄÊúâÁõ∏ÂÖ≥ÁöÑÁ¥¢ÂºïÂºïÁî®
                    const inputs = element.querySelectorAll('[data-user-index]');
                    inputs.forEach(input => {
                        input.setAttribute('data-user-index', currentIndex - 1);
                    });
                    // Êõ¥Êñ∞ÊåâÈíÆÁöÑonclickÂ±ûÊÄß
                    const removeBtn = element.querySelector('.remove-item-btn');
                    if (removeBtn) {
                        removeBtn.setAttribute('onclick', `removeUser(${currentIndex - 1})`);
                    }
                }
            });
        }
    }

    function addListItem(listType, userIndex) {
        if (!configData.users[userIndex][listType]) {
            configData.users[userIndex][listType] = [];
        }
        configData.users[userIndex][listType].push('');
        // ‰∏çÂÜçÈáçÊñ∞ÁîüÊàêÊï¥‰∏™Ë°®ÂçïÔºåËÄåÊòØÁõ¥Êé•Ê∑ªÂä†Êñ∞È°πÂà∞DOM
        const listContainer = document.getElementById(`${listType}-${userIndex}`);
        if (listContainer) {
            const itemIndex = configData.users[userIndex][listType].length - 1;
            let itemDiv = document.createElement('div');
            itemDiv.className = 'list-item edit-compact';
            if (listType === 'banList') {
                // Êñ∞Â¢ûÁ¶ÅÁî®Ëã±ÈõÑÔºöÂàÜË∑Ø‰∏ãÊãâ+Ëã±ÈõÑ‰∏ãÊãâ
                itemDiv.innerHTML = `
                    <select data-list-type="banLane" data-user-index="${userIndex}" data-item-index="${itemIndex}" onchange="updateBanHeroSelect(this)">${renderLaneOptions('')}</select>
                    <select data-list-type="banHero" data-user-index="${userIndex}" data-item-index="${itemIndex}">${renderHeroOptions('', '')}</select>
                    <button type="button" class="remove-item-btn" onclick="removeListItem('banList', ${userIndex}, ${itemIndex})" title="Âà†Èô§"><span class="remove-icon">üóëÔ∏è</span></button>
                `;
            } else if (listType === 'weightList') {
                // Êñ∞Â¢ûÊùÉÈáçËã±ÈõÑÔºöÂàÜË∑Ø‰∏ãÊãâ+Ëã±ÈõÑ‰∏ãÊãâ+Êï∞Â≠óËæìÂÖ•
                itemDiv.innerHTML = `
                    <select data-list-type="weightLane" data-user-index="${userIndex}" data-item-index="${itemIndex}" onchange="updateWeightHeroSelect(this)">${renderLaneOptions('')}</select>
                    <select data-list-type="weightHero" data-user-index="${userIndex}" data-item-index="${itemIndex}">${renderHeroOptions('', '')}</select>
                    <span style="margin:0 4px;">*</span>
                    <input type="number" min="1" max="1000" value="" data-list-type="weightNum" data-user-index="${userIndex}" data-item-index="${itemIndex}" placeholder="1~1000" style="width:60px;">
                    <button type="button" class="remove-item-btn" onclick="removeListItem('weightList', ${userIndex}, ${itemIndex})" title="Âà†Èô§"><span class="remove-icon">üóëÔ∏è</span></button>
                `;
            }
            listContainer.appendChild(itemDiv);
            // ËÅöÁÑ¶Âà∞Êñ∞ÂàõÂª∫ÁöÑÂàÜË∑Ø‰∏ãÊãâ
            const sel = itemDiv.querySelector('select');
            if (sel) sel.focus();
        }
    }

    function removeListItem(listType, userIndex, itemIndex) {
        configData.users[userIndex][listType].splice(itemIndex, 1);

        // ‰∏çÂÜçÈáçÊñ∞ÁîüÊàêÊï¥‰∏™Ë°®ÂçïÔºåËÄåÊòØÁõ¥Êé•ÁßªÈô§È°πÁõÆÂÖÉÁ¥†
        const listContainer = document.getElementById(`${listType}-${userIndex}`);
        if (listContainer) {
            const items = listContainer.querySelectorAll('.list-item');
            if (items[itemIndex]) {
                items[itemIndex].remove();
            }

            // Êõ¥Êñ∞Ââ©‰ΩôÈ°πÁõÆÁöÑÁ¥¢Âºï
            const remainingItems = listContainer.querySelectorAll('.list-item');
            remainingItems.forEach((item, index) => {
                const input = item.querySelector('input');
                const button = item.querySelector('button');
                if (input) {
                    input.setAttribute('data-item-index', index);
                }
                if (button) {
                    button.setAttribute('onclick', `removeListItem('${listType}', ${userIndex}, ${index})`);
                }
            });
        }
    }

    function parseSimpleYaml(yamlText) {
        // ÁÆÄÂçïÁöÑYAMLËß£ÊûêÂô®ÔºåÊîØÊåÅ‰ΩçÁΩÆÂàÜÁªÑÁªìÊûÑÂíåÁî®Êà∑ÁªìÊûÑ
        const lines = yamlText.split('\n');
        const result = {};
        let currentArray = null;
        let currentObject = null;
        let currentKey = null;
        let currentSubArray = null;
        let currentSubKey = null;
        let inMultiLineArray = false;
        let multiLineArrayKey = null;

        for (let line of lines) {
            line = line.trim();
            if (!line || line.startsWith('#')) continue;

            // Â§ÑÁêÜÂ§öË°åÊï∞ÁªÑÁªìÊùü
            if (inMultiLineArray && line === ']') {
                inMultiLineArray = false;
                multiLineArrayKey = null;
                continue;
            }

            // Â§ÑÁêÜÂ§öË°åÊï∞ÁªÑ‰∏≠ÁöÑÈ°πÁõÆ
            if (inMultiLineArray) {
                // Â§ÑÁêÜÂ∏¶ÂºïÂè∑ÁöÑÈ°πÁõÆÔºåÂèØËÉΩÊúâÂ∞æÈöèÈÄóÂè∑
                if (line.startsWith('"') && (line.endsWith('"') || line.endsWith('",') || line.endsWith('",'))) {
                    const item = line.replace(/^"|"$|",$|",$/g, '');
                    if (currentObject && multiLineArrayKey && currentObject[multiLineArrayKey] && item.trim()) {
                        currentObject[multiLineArrayKey].push(item);
                    }
                    continue;
                }
                // Â§ÑÁêÜ‰∏çÂ∏¶ÂºïÂè∑ÁöÑÈ°πÁõÆÔºåÂèØËÉΩÊúâÂ∞æÈöèÈÄóÂè∑
                else if (!line.includes('[') && !line.includes(']') && line.trim() && !line.endsWith(':')) {
                    const item = line.replace(/,$/, '').trim();
                    if (currentObject && multiLineArrayKey && currentObject[multiLineArrayKey] && item) {
                        currentObject[multiLineArrayKey].push(item);
                    }
                    continue;
                }
            }

            if (line.endsWith(':')) {
                // Êï∞ÁªÑÊàñÂØπË±°ÂºÄÂßã
                currentKey = line.slice(0, -1).trim();
                if (currentKey === 'heroes' || currentKey === 'users') {
                    // Ê†áÂáÜheroesÊàñusersÁªìÊûÑ
                    result[currentKey] = [];
                    currentArray = result[currentKey];
                    currentSubArray = null;
                    currentSubKey = null;
                } else if (currentObject && (currentKey === 'banList' || currentKey === 'weightList')) {
                    // Áî®Êà∑ÁöÑbanListÊàñweightList
                    currentObject[currentKey] = [];
                    currentSubArray = currentObject[currentKey];
                    currentSubKey = currentKey;
                } else {
                    // ‰ΩçÁΩÆÂàÜÁªÑÁªìÊûÑÔºàÂØπÊäóË∑Ø„ÄÅÊâìÈáéÁ≠âÔºâ
                    result[currentKey] = [];
                    currentArray = result[currentKey];
                    currentSubArray = null;
                    currentSubKey = null;
                }
            } else if (line.startsWith('- name:') || line.startsWith('-name:')) {
                // Êñ∞ÁöÑÊï∞ÁªÑÈ°πÔºàÊ†áÂáÜheroesÊàñusersÁªìÊûÑÔºâ
                currentObject = {};
                if (currentArray) {
                    currentArray.push(currentObject);
                }
                const name = line.replace(/^-\s*name:\s*/, '').replace(/"/g, '');
                currentObject.name = name;
                currentSubArray = null;
                currentSubKey = null;
            } else if (line.startsWith('- ')) {
                // ÂàóË°®È°π
                const itemValue = line.replace(/^-\s*/, '').trim().replace(/"/g, '');
                if (currentSubArray) {
                    // Â≠êÊï∞ÁªÑÈ°πÔºàbanListÊàñweightListÔºâ
                    if (itemValue) {
                        currentSubArray.push(itemValue);
                    }
                } else if (currentArray) {
                    // ÁÆÄÂçïÁöÑÂàóË°®È°πÔºà‰ΩçÁΩÆÂàÜÁªÑÁªìÊûÑÔºâ
                    if (itemValue) {
                        currentArray.push(itemValue);
                    }
                }
            } else if (line.includes(':') && currentObject) {
                // ÂØπË±°Â±ûÊÄß
                const [key, ...valueParts] = line.split(':');
                const value = valueParts.join(':').trim();
                const keyName = key.trim();

                if (keyName === 'banList' || keyName === 'weightList') {
                    // Â§ÑÁêÜÂÜÖËÅîÊï∞ÁªÑÊ†ºÂºèÔºåÂ¶Ç banList: [ ] Êàñ banList: ["item1", "item2"]
                    currentObject[keyName] = [];
                    if (value.includes('[') && value.includes(']')) {
                        // ÂçïË°åÂÜÖËÅîÊï∞ÁªÑÊ†ºÂºè
                        const arrayContent = value.substring(value.indexOf('[') + 1, value.lastIndexOf(']')).trim();
                        if (arrayContent) {
                            // ÂàÜÂâ≤Êï∞ÁªÑÈ°πÂπ∂Ê∏ÖÁêÜÂºïÂè∑
                            const items = arrayContent.split(',').map(item => 
                                item.trim().replace(/^["']|["']$/g, '')
                            ).filter(item => item.length > 0);
                            currentObject[keyName] = items;
                        }
                    } else if (value.trim() === '[') {
                        // Â§öË°åÊï∞ÁªÑÂºÄÂßã
                        inMultiLineArray = true;
                        multiLineArrayKey = keyName;
                    }
                } else if (keyName !== 'name') {
                    let processedValue = value.replace(/"/g, '');
                    // Â§ÑÁêÜÂ∏ÉÂ∞îÂÄº
                    if (keyName === 'disable') {
                        processedValue = processedValue === 'true';
                    }
                    currentObject[keyName] = processedValue;
                }
            }
        }

        // Â¶ÇÊûúËß£ÊûêÂá∫ÁöÑÊòØ‰ΩçÁΩÆÂàÜÁªÑÁªìÊûÑÔºåËΩ¨Êç¢‰∏∫heroesÊï∞ÁªÑÊ†ºÂºè
        if (!result.heroes && !result.users && Object.keys(result).length > 0) {
            result.heroes = [];
            for (const [position, heroList] of Object.entries(result)) {
                if (Array.isArray(heroList)) {
                    heroList.forEach(heroName => {
                        if (typeof heroName === 'string' && heroName.trim()) {
                            result.heroes.push({
                                name: heroName,
                                type: position,
                                skill: '',
                                description: ''
                            });
                        }
                    });
                }
            }
        }

        return result;
    }

    function saveFormChanges() {
        if (currentConfigType === 'user') {
            const userInputs = document.querySelectorAll('.user-name-input');
            const users = [];
            userInputs.forEach(input => {
                const userIndex = parseInt(input.dataset.userIndex);
                const name = input.value.trim();
                if (name) {
                    // Ëé∑ÂèñÁ¶ÅÁî®Áä∂ÊÄÅ
                    const disableInput = document.querySelector(`.user-disable-input[data-user-index='${userIndex}']`);
                    const disable = disableInput ? disableInput.checked : false;

                    const user = { name: name, banList: [], weightList: [], disable: disable };
                    // Âè™‰øùÂ≠òËØ•Áî®Êà∑ÁöÑbanList
                    const banHeroInputs = document.querySelectorAll(`select[data-list-type='banHero'][data-user-index='${userIndex}']`);
                    banHeroInputs.forEach(sel => {
                        const hero = sel.value.trim();
                        if (hero) user.banList.push(hero);
                    });
                    // Âè™‰øùÂ≠òËØ•Áî®Êà∑ÁöÑweightList
                    const weightHeroInputs = document.querySelectorAll(`select[data-list-type='weightHero'][data-user-index='${userIndex}']`);
                    const weightNumInputs = document.querySelectorAll(`input[data-list-type='weightNum'][data-user-index='${userIndex}']`);
                    for (let i = 0; i < weightHeroInputs.length; i++) {
                        const hero = weightHeroInputs[i].value.trim();
                        let num = weightNumInputs[i].value.trim();
                        if (hero && num) {
                            let n = parseInt(num, 10);
                            if (isNaN(n) || n < 1) n = 1;
                            if (n > 1000) n = 1000;
                            user.weightList.push(`${hero}*${n}`);
                        }
                    }
                    users.push(user);
                }
            });
            configData.users = users;
        } else {
            // Êî∂ÈõÜËã±ÈõÑË°®ÂçïÊï∞ÊçÆ
            const heroInputs = document.querySelectorAll('.hero-name-input');
            const heroes = [];

            heroInputs.forEach(input => {
                const name = input.value.trim();
                const position = input.dataset.position;
                if (name && position) {
                    heroes.push({ name, type: position });
                }
            });
            configData.heroes = heroes;
        }

        // ËΩ¨Êç¢‰∏∫YAMLÊ†ºÂºè
        const newYamlContent = generateYamlFromConfig(configData);

        // Êõ¥Êñ∞YAMLÁºñËæëÂô®ÂÜÖÂÆπ
        document.getElementById('yamlContent').textContent = newYamlContent;
        document.getElementById('yamlEditor').value = newYamlContent;
        originalYamlContent = newYamlContent;

        // Ë∞ÉÁî®‰øùÂ≠òAPI
        let editApiUrl = '';
        if (currentConfigType === 'hero') {
            editApiUrl = API_BASE_URL + '/gagaFamily/conf/heroEdit';
        } else if (currentConfigType === 'user') {
            editApiUrl = API_BASE_URL + '/gagaFamily/conf/userEdit';
        } else {
            alert('Êó†Ê≥ïÁ°ÆÂÆöÈÖçÁΩÆÁ±ªÂûã');
            return;
        }

        // ÊòæÁ§∫‰øùÂ≠ò‰∏≠Áä∂ÊÄÅ
        const saveBtn = document.querySelector('.save-btn');
        const originalText = saveBtn.textContent;
        saveBtn.textContent = '‰øùÂ≠ò‰∏≠...';
        saveBtn.disabled = true;

        fetch(editApiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain'
            },
            body: newYamlContent
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('‰øùÂ≠òÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†ÅÔºö' + response.status);
                }
                return response.text();
            })
            .then(data => {
                setEditMode(false);
                alert('‰øùÂ≠òÊàêÂäüÔºö' + data);
            })
            .catch(error => {
                alert('‰øùÂ≠òÂ§±Ë¥•Ôºö' + error.message);
            })
            .finally(() => {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            });
    }

    function generateYamlFromConfig(config) {
        if (currentConfigType === 'hero' && config.heroes) {
            // Êåâ‰ΩçÁΩÆÂàÜÁªÑËã±ÈõÑ
            const positionGroups = {};
            config.heroes.forEach(hero => {
                if (!hero.name.trim()) return; // Ë∑≥ËøáÁ©∫ÂêçÁß∞ÁöÑËã±ÈõÑ

                const position = hero.type || 'Êú™ÂàÜÁ±ª';
                if (!positionGroups[position]) {
                    positionGroups[position] = [];
                }
                positionGroups[position].push(hero.name);
            });

            // ÁîüÊàê‰ΩçÁΩÆÂàÜÁªÑÁöÑYAMLÊ†ºÂºè
            let yaml = '';
            for (const [position, heroList] of Object.entries(positionGroups)) {
                if (heroList.length > 0) {
                    yaml += `${position}:\n`;
                    heroList.forEach(heroName => {
                        yaml += `  - ${heroName}\n`;
                    });
                }
            }
            return yaml;
        } else if (currentConfigType === 'user' && config.users) {
            // ÁîüÊàêÁî®Êà∑ÈÖçÁΩÆÁöÑYAMLÊ†ºÂºè
            let yaml = 'users:\n';
            config.users.forEach(user => {
                if (!user.name.trim()) return; // Ë∑≥ËøáÁ©∫ÂêçÁß∞ÁöÑÁî®Êà∑

                yaml += `  - name: "${user.name}"\n`;

                // ÁîüÊàêbanList
                yaml += '    banList: ';
                if (user.banList && user.banList.length > 0) {
                    yaml += '[\n';
                    user.banList.forEach((hero, index) => {
                        if (hero.trim()) {
                            yaml += `      "${hero}"`;
                            if (index < user.banList.length - 1) {
                                yaml += ',';
                            }
                            yaml += '\n';
                        }
                    });
                    yaml += '    ]\n';
                } else {
                    yaml += '[ ]\n';
                }

                // ÁîüÊàêweightList
                yaml += '    weightList: ';
                if (user.weightList && user.weightList.length > 0) {
                    yaml += '[\n';
                    user.weightList.forEach((hero, index) => {
                        if (hero.trim()) {
                            yaml += `      "${hero}"`;
                            if (index < user.weightList.length - 1) {
                                yaml += ',';
                            }
                            yaml += '\n';
                        }
                    });
                    yaml += '    ]\n';
                } else {
                    yaml += '[ ]\n';
                }

                // ÁîüÊàêdisableÂ≠óÊÆµ
                if (user.disable !== undefined) {
                    yaml += `    disable: ${user.disable}\n`;
                }
            });
            return yaml;
        }
        return originalYamlContent; // ÂõûÈÄÄÂà∞ÂéüÂßãÂÜÖÂÆπ
    }

    function cancelEdit() {
        // ÂèñÊ∂àÁºñËæëÔºåÊÅ¢Â§çÂéüÂßãÂÜÖÂÆπ
        document.getElementById('yamlEditor').value = originalYamlContent;
        try {
            configData = parseSimpleYaml(originalYamlContent);
        } catch (error) {
            console.error('YAMLËß£ÊûêÈîôËØØ:', error);
        }
        setEditMode(false);
    }

    function saveChanges() {
        // YAMLÁºñËæëÊ®°ÂºèÁöÑ‰øùÂ≠ò
        const newContent = document.getElementById('yamlEditor').value;

        // ÁÆÄÂçïÈ™åËØÅ
        if (!newContent.trim()) {
            alert('ÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫');
            return;
        }

        document.getElementById('yamlContent').textContent = newContent;
        originalYamlContent = newContent;

        // Ê†πÊçÆÈÖçÁΩÆÁ±ªÂûãÈÄâÊã©ÂØπÂ∫îÁöÑÁºñËæëAPIÁ´ØÁÇπ
        let editApiUrl = '';
        if (currentConfigType === 'hero') {
            editApiUrl = API_BASE_URL + '/gagaFamily/conf/heroEdit';
        } else if (currentConfigType === 'user') {
            editApiUrl = API_BASE_URL + '/gagaFamily/conf/userEdit';
        } else {
            alert('Êó†Ê≥ïÁ°ÆÂÆöÈÖçÁΩÆÁ±ªÂûã');
            return;
        }

        // ÊòæÁ§∫‰øùÂ≠ò‰∏≠Áä∂ÊÄÅ
        const saveBtn = document.querySelector('#yamlEditContainer .save-btn');
        const originalText = saveBtn.textContent;
        saveBtn.textContent = '‰øùÂ≠ò‰∏≠...';
        saveBtn.disabled = true;

        fetch(editApiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain'
            },
            body: newContent
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('‰øùÂ≠òÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†ÅÔºö' + response.status);
                }
                return response.text();
            })
            .then(data => {
                // Êõ¥Êñ∞Ëß£ÊûêÁöÑÊï∞ÊçÆ
                try {
                    configData = parseSimpleYaml(newContent);
                } catch (error) {
                    console.error('YAMLËß£ÊûêÈîôËØØ:', error);
                }
                setEditMode(false);
                alert('‰øùÂ≠òÊàêÂäüÔºö' + data);
            })
            .catch(error => {
                alert('‰øùÂ≠òÂ§±Ë¥•Ôºö' + error.message);
            })
            .finally(() => {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            });
    }

    // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®Âå∫ÂüüÂÖ≥Èó≠ÂºπÁ™ó
    window.onclick = function(event) {
        const modal = document.getElementById('yamlModal');
        if (event.target === modal) {
            closeModal();
        }
        const groupResultModal = document.getElementById('groupResultModal');
        if (event.target === groupResultModal) {
            closeGroupResultModal();
        }
    }

    // ÈîÆÁõòÂø´Êç∑ÈîÆÊîØÊåÅ
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal();
            closeGroupResultModal();
        }
    });

    // ToastÊèêÁ§∫ÂáΩÊï∞
    function showToast(msg) {
        let toast = document.querySelector('.toast');
        if (!toast) {
            toast = document.createElement('div');
            toast.className = 'toast';
            document.body.appendChild(toast);
        }
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    }
    // Âú®‰øùÂ≠ò„ÄÅÂà†Èô§Á≠âÊìç‰ΩúÊàêÂäü/Â§±Ë¥•Êó∂Ë∞ÉÁî® showToast('Êìç‰ΩúÊàêÂäü')

    // ÂàÜÁªÑÁªìÊûúÂºπÁ™ó
    function showGroupResultModal(text) {
        // Ëß£ÊûêÂàÜÁªÑÊñáÊú¨
        const groupBlocks = text.split(/-+/).filter(block => block.trim().length > 0);
        let html = '<div class="group-result-container">';
        let groupIndex = 1;
        let remarkHtml = '';
        groupBlocks.forEach((block, idx) => {
            const lines = block.split('\n').map(l => l.trim()).filter(l => l);
            if (lines.length === 0) return;
            // Á¨¨‰∏âÁªÑ‰Ωú‰∏∫Â§áÊ≥®ÔºåÊöÇÂ≠ò
            if (groupIndex === 3) {
                remarkHtml += `<div class='group-remark'>`;
                lines.forEach(line => {
                    remarkHtml += `<div class='remark-line'>${line}</div>`;
                });
                remarkHtml += `</div>`;
            } else {
                html += `<div class="group-table-card">`;
                html += `<div class="group-table-title">Á¨¨${groupIndex}ÁªÑ</div>`;
                html += '<table class="group-table"><tbody>';
                lines.forEach(line => {
                    // ‰æã: [ÂØπÊäóË∑Ø]Áé©ÂÆ∂‰∏∫[Âº†‰∏â]ÈöèÊú∫Ëã±ÈõÑ‰∏∫[ÂêïÂ∏É]
                    const m = line.match(/\[(.+?)\]Áé©ÂÆ∂‰∏∫\[(.+?)\]ÈöèÊú∫Ëã±ÈõÑ‰∏∫\[(.+?)\]/);
                    if (m) {
                        html += `<tr><td class='group-td-pos'>${m[1]}</td><td class='group-td-name'>${m[2]}</td><td class='group-td-hero'>${m[3]}</td></tr>`;
                    } else {
                        html += `<tr><td colspan='3' class='group-td-other'>${line}</td></tr>`;
                    }
                });
                html += '</tbody></table>';
                html += '</div>';
            }
            groupIndex++;
        });
        html += '</div>';
        // Â§áÊ≥®ÊîæÊúÄ‰∏ãÊñπ
        html += `<div class='group-remark-outer'>${remarkHtml}</div>`;
        // ÂºπÁ™ó
        let modal = document.getElementById('groupResultModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'groupResultModal';
            modal.className = 'modal';
            modal.innerHTML = `<div class="modal-content"><div class="modal-header"><h2>ÂàÜÁªÑÁªìÊûú</h2><span class="close" onclick="closeGroupResultModal()">&times;</span></div><div class="modal-body" id="groupResultBody"></div></div>`;
            document.body.appendChild(modal);
        }
        document.getElementById('groupResultBody').innerHTML = html;
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
    function closeGroupResultModal() {
        const modal = document.getElementById('groupResultModal');
        if (modal) modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    // Êã¶Êà™ÂàÜÁªÑÊåâÈíÆalert
    const oldAlert = window.alert;
    window.alert = function(msg) {
        if (typeof msg === 'string' && msg.includes('Áé©ÂÆ∂‰∏∫')) {
            showGroupResultModal(msg);
        } else {
            oldAlert(msg);
        }
    };
</script>
<div class="toast"></div>
</body>
</html>
